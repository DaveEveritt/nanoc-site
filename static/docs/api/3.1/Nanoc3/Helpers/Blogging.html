<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: Nanoc3::Helpers::Blogging</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (B)</a> &raquo; 
    <span class='title'><a href="../../Nanoc3.html" title="Nanoc3 (module)">Nanoc3</a></span> &raquo; <span class='title'><a href="../Helpers.html" title="Nanoc3::Helpers (module)">Helpers</a></span>
     &raquo; 
    <span class="title">Blogging</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Nanoc3::Helpers::Blogging 
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/nanoc3/helpers/blogging.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Provides functionality for building blogs, such as finding articles and
constructing feeds.</p>

<p>This helper has a few requirements. First, all blog articles should have
the following attributes:</p>

<ul>
<li><p><code>kind</code> — Set to <code>"article"</code></p></li>
<li><p><code>created_at</code> — The article’s publication timestamp</p></li>
</ul>


<p>Some functions in this blogging helper, such as the <tt><a href="#atom_feed-instance_method" title="Nanoc3::Helpers::Blogging#atom_feed (method)">#atom_feed</a></tt> function,
require additional attributes to be set; these attributes are described in
the documentation for these functions.</p>

<p>All “time” item attributes, site configuration attributes or method
parameters can either be a <code>Time</code> instance or a string in any format
parseable by <code>Time.parse</code>.</p>

<p>The two main functions are <tt><a href="#sorted_articles-instance_method" title="Nanoc3::Helpers::Blogging#sorted_articles (method)">#sorted_articles</a></tt> and <tt><a href="#atom_feed-instance_method" title="Nanoc3::Helpers::Blogging#atom_feed (method)">#atom_feed</a></tt>.</p>

  </div>
</div>
<div class="tags">
  
</div>


  
    <h2>Instance Method Summary</h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#articles-instance_method" title="#articles (instance method)">- (Array) <strong>articles</strong> </a>
    

    
  </span>
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns an unsorted list of articles, i.e.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#atom_feed-instance_method" title="#atom_feed (instance method)">- (String) <strong>atom_feed</strong>(params = {}) </a>
    

    
  </span>
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a string representing the atom feed containing recent articles,
sorted by descending creation date.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#atom_tag_for-instance_method" title="#atom_tag_for (instance method)">- (String) <strong>atom_tag_for</strong>(item) </a>
    

    
  </span>
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns an URI containing an unique ID for the given item.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#feed_url-instance_method" title="#feed_url (instance method)">- (String) <strong>feed_url</strong> </a>
    

    
  </span>
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the URL of the feed.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sorted_articles-instance_method" title="#sorted_articles (instance method)">- (Array) <strong>sorted_articles</strong> </a>
    

    
  </span>
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a sorted list of articles, i.e.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#url_for-instance_method" title="#url_for (instance method)">- (String) <strong>url_for</strong>(item) </a>
    

    
  </span>
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the URL for the given item.</p></div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="articles-instance_method">
  
    - (<tt><a href="../../Array.html" title="Array (class)">Array</a></tt>) <strong>articles</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns an unsorted list of articles, i.e. items where the <code>kind</code>
attribute is set to <code>"article"</code>.</p>

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a href="../../Array.html" title="Array (class)">Array</a></tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>An array containing all articles</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nanoc3/helpers/blogging.rb', line 30</span>

<span class='kw'>def</span> <span class='id articles'>articles</span>
  <span class='ivar'>@items</span><span class='period'>.</span><span class='id select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id item'>item</span><span class='op'>|</span> <span class='id item'>item</span><span class='lbracket'>[</span><span class='symbol'>:kind</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>article</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="atom_feed-instance_method">
  
    - (<tt><a href="../../String.html" title="String (class)">String</a></tt>) <strong>atom_feed</strong>(params = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns a string representing the atom feed containing recent articles,
sorted by descending creation date.</p>

<p>The following attributes must be set on blog articles:</p>

<ul>
<li><p><code>title</code> — The title of the blog post</p></li>
<li><p><code>kind</code> and <code>created_at</code> (described above)</p></li>
</ul>


<p>The following attributes can optionally be set on blog articles to
change the behaviour of the Atom feed:</p>

<ul>
<li><p><code>excerpt</code> — An excerpt of the article, which is usually only a few
lines long.</p></li>
<li><p><code>custom_path_in_feed</code> — The path that will be used instead of the
normal path in the feed. This can be useful when including
non-outputted items in a feed; such items could have their custom feed
path set to the blog path instead, for example.</p></li>
<li><p><code>custom_url_in_feed</code> — The url that will be used instead of the
normal url in the feed (generated from the site’s base url + the item
rep’s path). This can be useful when building a link-blog where the
URL of article is a remote location.</p></li>
<li><p><code>updated_at</code> — The time when the article was last modified. If this
attribute is not present, the <code>created_at</code> attribute will be used as
the time when the article was last modified.</p></li>
</ul>


<p>The site configuration will need to have the following attributes:</p>

<ul>
<li><code>base_url</code> — The URL to the site, without trailing slash. For
example, if the site is at “http://example.com/”, the <code>base_url</code>
would be “http://example.com”.</li>
</ul>


<p>The feed item will need to know about the feed title, the feed author
name, and the URI corresponding to the author. These can be specified
using parameters, as attributes in the feed item, or in the site
configuration. <br/>
</p>

<ul>
<li><p><code>title</code> — The title of the feed, which is usually also the title of
the blog.</p></li>
<li><p><code>author_name</code> — The name of the item’s author.</p></li>
<li><p><code>author_uri</code> — The URI for the item’s author, such as the author’s
web site URL.</p></li>
</ul>


<p>The feed item can have the following optional attributes:</p>

<ul>
<li><code>feed_url</code> — The custom URL of the feed. This can be useful when the
private feed URL shouldn’t be exposed; for example, when using
FeedBurner this would be set to the public FeedBurner URL.</li>
</ul>


<p>To construct a feed, create a new item and make sure that it is
filtered with <code>:erb</code> or <code>:erubis</code>; it should not be laid out. Ensure
that it is routed to the proper path, e.g. <code>/blog.xml</code>. It may also be
useful to set the <code>is_hidden</code> attribute to true, so that helpers such
as the sitemap helper will ignore the item. The content of the feed
item should be <code>&lt;%= atom_feed %&gt;</code>.</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>Defining compilation and routing rules for a feed item</p></div></h4>
      <pre class="example code">
<span class='id compile'>compile</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/blog/feed/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id filter'>filter</span> <span class='symbol'>:erb</span>
<span class='kw'>end</span>

<span class='id route'>route</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/blog/feed/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/blog.xml</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    
      <h4><div class='inline'><p>Limiting the number of items in a feed</p></div></h4>
      <pre class="example code">
&lt;%= atom_feed :limit =&gt; 5 %&gt;</pre>
    
  </div>

  
    
    
    <h3>Options Hash (<tt>params</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>Number</tt>)</span>
          <span class="name">:limit</span>
          <span class="default">
            
              &mdash; default:
              <tt>5</tt>
            
          </span>
          &mdash;<div class='inline'><p>The maximum number of articles to
show</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt><a href="../../Array.html" title="Array (class)">Array</a></tt>)</span>
          <span class="name">:articles</span>
          <span class="default">
            
              &mdash; default:
              <tt>sorted_articles</tt>
            
          </span>
          &mdash;<div class='inline'><p>A list of articles to
include in the feed</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>Proc</tt>)</span>
          <span class="name">:content_proc</span>
          <span class="default">
            
              &mdash; default:
              <tt>-&gt;{ |article|
article.compiled_content(:snapshot =&gt; :pre) }</tt>
            
          </span>
          &mdash;<div class='inline'><p>A proc that returns the
content of the given article, which is passed as a parameter. This
function may not return nil.</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt>proc</tt>)</span>
          <span class="name">:excerpt_proc</span>
          <span class="default">
            
              &mdash; default:
              <tt>-&gt;{ |article| article[:excerpt] }</tt>
            
          </span>
          &mdash;<div class='inline'><p>A proc that returns the excerpt of the given article, passed as a
parameter. This function should return nil if there is no excerpt.</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt><a href="../../String.html" title="String (class)">String</a></tt>)</span>
          <span class="name">:title</span>
          <span class="default">
            
              <span class="na">N/A</span>
            
          </span>
          &mdash;<div class='inline'><p>The feed’s title, if it is not given in
the item attributes.</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt><a href="../../String.html" title="String (class)">String</a></tt>)</span>
          <span class="name">:author_name</span>
          <span class="default">
            
              <span class="na">N/A</span>
            
          </span>
          &mdash;<div class='inline'><p>The name of the feed’s author, if
it is not given in the item attributes.</p></div>
        </tr>
      
        <li>
          <span class="type">(<tt><a href="../../String.html" title="String (class)">String</a></tt>)</span>
          <span class="name">:author_uri</span>
          <span class="default">
            
              <span class="na">N/A</span>
            
          </span>
          &mdash;<div class='inline'><p>The URI of the feed’s author, if it
is not given in the item attributes.</p></div>
        </tr>
      
    </ul>
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a href="../../String.html" title="String (class)">String</a></tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>The generated feed content</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nanoc3/helpers/blogging.rb', line 147</span>

<span class='kw'>def</span> <span class='id atom_feed'>atom_feed</span><span class='lparen'>(</span><span class='id params'>params</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>builder</span><span class='tstring_end'>'</span></span>
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>time</span><span class='tstring_end'>'</span></span>

  <span class='comment'># Extract parameters
</span>  <span class='id limit'>limit</span>             <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:limit</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>5</span>
  <span class='id relevant_articles'>relevant_articles</span> <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:articles</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id articles'>articles</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id content_proc'>content_proc</span>      <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:content_proc</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id a'>a</span><span class='op'>|</span> <span class='id a'>a</span><span class='period'>.</span><span class='id compiled_content'>compiled_content</span><span class='lparen'>(</span><span class='symbol'>:snapshot</span> <span class='op'>=&gt;</span> <span class='symbol'>:pre</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id excerpt_proc'>excerpt_proc</span>      <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:excerpt_proc</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id a'>a</span><span class='op'>|</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='symbol'>:excerpt</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

  <span class='comment'># Check config attributes
</span>  <span class='kw'>if</span> <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:base_url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id nil?'>nil?</span>
    <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Cannot build Atom feed: site configuration has no base_url</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Check feed item attributes
</span>  <span class='id title'>title</span> <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@item</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id title'>title</span><span class='period'>.</span><span class='id nil?'>nil?</span>
    <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Cannot build Atom feed: no title in params, item or site config</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id author_name'>author_name</span> <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:author_name</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@item</span><span class='lbracket'>[</span><span class='symbol'>:author_name</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:author_name</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id author_name'>author_name</span><span class='period'>.</span><span class='id nil?'>nil?</span>
    <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Cannot build Atom feed: no author_name in params, item or site config</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id author_uri'>author_uri</span> <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:author_uri</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@item</span><span class='lbracket'>[</span><span class='symbol'>:author_uri</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:author_uri</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id author_uri'>author_uri</span><span class='period'>.</span><span class='id nil?'>nil?</span>
    <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Cannot build Atom feed: no author_uri in params, item or site config</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Check article attributes
</span>  <span class='kw'>if</span> <span class='id relevant_articles'>relevant_articles</span><span class='period'>.</span><span class='id empty?'>empty?</span>
    <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Cannot build Atom feed: no articles</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id relevant_articles'>relevant_articles</span><span class='period'>.</span><span class='id any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id a'>a</span><span class='op'>|</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='symbol'>:created_at</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='rbrace'>}</span>
    <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Cannot build Atom feed: one or more articles lack created_at</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Get sorted relevant articles
</span>  <span class='id sorted_relevant_articles'>sorted_relevant_articles</span> <span class='op'>=</span> <span class='id relevant_articles'>relevant_articles</span><span class='period'>.</span><span class='id sort_by'>sort_by</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id a'>a</span><span class='op'>|</span>
    <span class='id time'>time</span> <span class='op'>=</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='symbol'>:created_at</span><span class='rbracket'>]</span>
    <span class='id time'>time</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'>Time</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id time'>time</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id time'>time</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id reverse'>reverse</span><span class='period'>.</span><span class='id first'>first</span><span class='lparen'>(</span><span class='id limit'>limit</span><span class='rparen'>)</span>

  <span class='comment'># Get most recent article
</span>  <span class='id last_article'>last_article</span> <span class='op'>=</span> <span class='id sorted_relevant_articles'>sorted_relevant_articles</span><span class='period'>.</span><span class='id first'>first</span>

  <span class='comment'># Create builder
</span>  <span class='id buffer'>buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='id xml'>xml</span> <span class='op'>=</span> <span class='const'>Builder</span><span class='op'>::</span><span class='const'>XmlMarkup</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='symbol'>:target</span> <span class='op'>=&gt;</span> <span class='id buffer'>buffer</span><span class='comma'>,</span> <span class='symbol'>:indent</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='rparen'>)</span>

  <span class='comment'># Build feed
</span>  <span class='id xml'>xml</span><span class='period'>.</span><span class='id instruct!'>instruct!</span>
  <span class='id xml'>xml</span><span class='period'>.</span><span class='id feed'>feed</span><span class='lparen'>(</span><span class='symbol'>:xmlns</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://www.w3.org/2005/Atom</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id root_url'>root_url</span> <span class='op'>=</span> <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:base_url</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span>

    <span class='comment'># Add primary attributes
</span>    <span class='id xml'>xml</span><span class='period'>.</span><span class='id id'>id</span>      <span class='id root_url'>root_url</span>
    <span class='id xml'>xml</span><span class='period'>.</span><span class='id title'>title</span>   <span class='id title'>title</span>

    <span class='comment'># Add date
</span>    <span class='id time'>time</span> <span class='op'>=</span> <span class='id last_article'>last_article</span><span class='lbracket'>[</span><span class='symbol'>:created_at</span><span class='rbracket'>]</span>
    <span class='id xml'>xml</span><span class='period'>.</span><span class='id updated'>updated</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id time'>time</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'>Time</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id time'>time</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id time'>time</span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_iso8601_time'>to_iso8601_time</span><span class='rparen'>)</span>

    <span class='comment'># Add links
</span>    <span class='id xml'>xml</span><span class='period'>.</span><span class='id link'>link</span><span class='lparen'>(</span><span class='symbol'>:rel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>alternate</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:href</span> <span class='op'>=&gt;</span> <span class='id root_url'>root_url</span><span class='rparen'>)</span>
    <span class='id xml'>xml</span><span class='period'>.</span><span class='id link'>link</span><span class='lparen'>(</span><span class='symbol'>:rel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>self</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>      <span class='symbol'>:href</span> <span class='op'>=&gt;</span> <span class='id feed_url'>feed_url</span><span class='rparen'>)</span>

    <span class='comment'># Add author information
</span>    <span class='id xml'>xml</span><span class='period'>.</span><span class='id author'>author</span> <span class='kw'>do</span>
      <span class='id xml'>xml</span><span class='period'>.</span><span class='id name'>name</span>  <span class='id author_name'>author_name</span>
      <span class='id xml'>xml</span><span class='period'>.</span><span class='id uri'>uri</span>   <span class='id author_uri'>author_uri</span>
    <span class='kw'>end</span>

    <span class='comment'># Add articles
</span>    <span class='id sorted_relevant_articles'>sorted_relevant_articles</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id a'>a</span><span class='op'>|</span>
      <span class='comment'># Get URL
</span>      <span class='id url'>url</span> <span class='op'>=</span> <span class='id url_for'>url_for</span><span class='lparen'>(</span><span class='id a'>a</span><span class='rparen'>)</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id url'>url</span><span class='period'>.</span><span class='id nil?'>nil?</span>

      <span class='id xml'>xml</span><span class='period'>.</span><span class='id entry'>entry</span> <span class='kw'>do</span>
        <span class='comment'># Add primary attributes
</span>        <span class='id xml'>xml</span><span class='period'>.</span><span class='id id'>id</span>        <span class='id atom_tag_for'>atom_tag_for</span><span class='lparen'>(</span><span class='id a'>a</span><span class='rparen'>)</span>
        <span class='id xml'>xml</span><span class='period'>.</span><span class='id title'>title</span>     <span class='id a'>a</span><span class='lbracket'>[</span><span class='symbol'>:title</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>html</span><span class='tstring_end'>'</span></span>

        <span class='comment'># Add dates
</span>        <span class='id create_time'>create_time</span> <span class='op'>=</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='symbol'>:created_at</span><span class='rbracket'>]</span>
        <span class='id update_time'>update_time</span> <span class='op'>=</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='symbol'>:updated_at</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='symbol'>:created_at</span><span class='rbracket'>]</span>
        <span class='id xml'>xml</span><span class='period'>.</span><span class='id published'>published</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id create_time'>create_time</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'>Time</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id create_time'>create_time</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id create_time'>create_time</span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_iso8601_time'>to_iso8601_time</span><span class='rparen'>)</span>
        <span class='id xml'>xml</span><span class='period'>.</span><span class='id updated'>updated</span><span class='lparen'>(</span>  <span class='lparen'>(</span><span class='id update_time'>update_time</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'>Time</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id update_time'>update_time</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id update_time'>update_time</span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_iso8601_time'>to_iso8601_time</span><span class='rparen'>)</span>

        <span class='comment'># Add link
</span>        <span class='id xml'>xml</span><span class='period'>.</span><span class='id link'>link</span><span class='lparen'>(</span><span class='symbol'>:rel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>alternate</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:href</span> <span class='op'>=&gt;</span> <span class='id url'>url</span><span class='rparen'>)</span>

        <span class='comment'># Add content
</span>        <span class='id summary'>summary</span> <span class='op'>=</span> <span class='id excerpt_proc'>excerpt_proc</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span><span class='id a'>a</span><span class='rparen'>)</span>
        <span class='id xml'>xml</span><span class='period'>.</span><span class='id content'>content</span>   <span class='id content_proc'>content_proc</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span><span class='id a'>a</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>html</span><span class='tstring_end'>'</span></span>
        <span class='id xml'>xml</span><span class='period'>.</span><span class='id summary'>summary</span>   <span class='id summary'>summary</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>html</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id summary'>summary</span><span class='period'>.</span><span class='id nil?'>nil?</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id buffer'>buffer</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="atom_tag_for-instance_method">
  
    - (<tt><a href="../../String.html" title="String (class)">String</a></tt>) <strong>atom_tag_for</strong>(item) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns an URI containing an unique ID for the given item. This will be
used in the Atom feed to uniquely identify articles. These IDs are
created using a procedure suggested by Mark Pilgrim and described in his
[“How to make a good ID in Atom” blog post]
(http://diveintomark.org/archives/2004/05/28/howto-atom-id).</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><a href="../Item.html" title="Nanoc3::Item (class)">Nanoc3::Item</a></tt>)</span>
      
      
        <span class='name'>item</span>
      
      
      
        &mdash;
        <div class='inline'><p>The item for which to create an atom tag</p></div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a href="../../String.html" title="String (class)">String</a></tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>The atom tag for the given item</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


295
296
297
298
299
300
301
302
303
304</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nanoc3/helpers/blogging.rb', line 295</span>

<span class='kw'>def</span> <span class='id atom_tag_for'>atom_tag_for</span><span class='lparen'>(</span><span class='id item'>item</span><span class='rparen'>)</span>
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>time</span><span class='tstring_end'>'</span></span>

  <span class='id hostname'>hostname</span><span class='comma'>,</span> <span class='id base_dir'>base_dir</span> <span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^.+?://([^/]+)(.*)$</span><span class='regexp_end'>}</span></span><span class='period'>.</span><span class='id match'>match</span><span class='lparen'>(</span><span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:base_url</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='int'>2</span><span class='rbracket'>]</span>

  <span class='id time'>time</span> <span class='op'>=</span> <span class='id item'>item</span><span class='lbracket'>[</span><span class='symbol'>:created_at</span><span class='rbracket'>]</span>
  <span class='id formatted_date'>formatted_date</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id time'>time</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'>Time</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id time'>time</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id time'>time</span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_iso8601_date'>to_iso8601_date</span>

  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tag:</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id hostname'>hostname</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id formatted_date'>formatted_date</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id base_dir'>base_dir</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id item'>item</span><span class='period'>.</span><span class='id path'>path</span> <span class='op'>||</span> <span class='id item'>item</span><span class='period'>.</span><span class='id identifier'>identifier</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="feed_url-instance_method">
  
    - (<tt><a href="../../String.html" title="String (class)">String</a></tt>) <strong>feed_url</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns the URL of the feed. It will return the custom feed URL if set,
or otherwise the normal feed URL.</p>

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a href="../../String.html" title="String (class)">String</a></tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>The URL of the feed</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277
278
279
280
281
282
283
284</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nanoc3/helpers/blogging.rb', line 277</span>

<span class='kw'>def</span> <span class='id feed_url'>feed_url</span>
  <span class='comment'># Check attributes
</span>  <span class='kw'>if</span> <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:base_url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id nil?'>nil?</span>
    <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Cannot build Atom feed: site configuration has no base_url</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='ivar'>@item</span><span class='lbracket'>[</span><span class='symbol'>:feed_url</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:base_url</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='ivar'>@item</span><span class='period'>.</span><span class='id path'>path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="sorted_articles-instance_method">
  
    - (<tt><a href="../../Array.html" title="Array (class)">Array</a></tt>) <strong>sorted_articles</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns a sorted list of articles, i.e. items where the <code>kind</code>
attribute is set to <code>"article"</code>. Articles are sorted by descending
creation date, so newer articles appear before older articles.</p>

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a href="../../Array.html" title="Array (class)">Array</a></tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>A sorted array containing all articles</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41
42
43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nanoc3/helpers/blogging.rb', line 39</span>

<span class='kw'>def</span> <span class='id sorted_articles'>sorted_articles</span>
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>time</span><span class='tstring_end'>'</span></span>
  <span class='id articles'>articles</span><span class='period'>.</span><span class='id sort_by'>sort_by</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id a'>a</span><span class='op'>|</span>
    <span class='id time'>time</span> <span class='op'>=</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='symbol'>:created_at</span><span class='rbracket'>]</span>
    <span class='id time'>time</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'>Time</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id time'>time</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id time'>time</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id reverse'>reverse</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="url_for-instance_method">
  
    - (<tt><a href="../../String.html" title="String (class)">String</a></tt>) <strong>url_for</strong>(item) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns the URL for the given item. It will return the URL containing
the custom path in the feed if possible, otherwise the normal path.</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><a href="../Item.html" title="Nanoc3::Item (class)">Nanoc3::Item</a></tt>)</span>
      
      
        <span class='name'>item</span>
      
      
      
        &mdash;
        <div class='inline'><p>The item for which to fetch the URL.</p></div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a href="../../String.html" title="String (class)">String</a></tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>The URL of the given item</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259
260
261
262
263
264
265
266
267
268
269
270
271</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nanoc3/helpers/blogging.rb', line 257</span>

<span class='kw'>def</span> <span class='id url_for'>url_for</span><span class='lparen'>(</span><span class='id item'>item</span><span class='rparen'>)</span>
  <span class='comment'># Check attributes
</span>  <span class='kw'>if</span> <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:base_url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id nil?'>nil?</span>
    <span class='id raise'>raise</span> <span class='const'>RuntimeError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Cannot build Atom feed: site configuration has no base_url</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Build URL
</span>  <span class='kw'>if</span> <span class='id item'>item</span><span class='lbracket'>[</span><span class='symbol'>:custom_url_in_feed</span><span class='rbracket'>]</span>
    <span class='id item'>item</span><span class='lbracket'>[</span><span class='symbol'>:custom_url_in_feed</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='id item'>item</span><span class='lbracket'>[</span><span class='symbol'>:custom_path_in_feed</span><span class='rbracket'>]</span>
    <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:base_url</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id item'>item</span><span class='lbracket'>[</span><span class='symbol'>:custom_path_in_feed</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='id item'>item</span><span class='period'>.</span><span class='id path'>path</span>
    <span class='ivar'>@site</span><span class='period'>.</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:base_url</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id item'>item</span><span class='period'>.</span><span class='id path'>path</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Mar 28 19:25:41 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.4 (ruby-1.9.1).
</div>

  </body>
</html>